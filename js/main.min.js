
$(document).ready(function(){var d=new WebSocket("ws://localhost:8080"),b=$(".chatForm"),g=b.find("#message"),c=$(".messages-list"),e=$(".username_setter"),a=e.find(".username-input"),f=$(".typing");b.on("submit",function(i){f.html(" ");i.preventDefault();var h={text:g.val(),sender:$.cookie("chat_name"),type:"message"};d.send(JSON.stringify(h));c.append("<li class='me'>"+h.text+"</li>");g.val(" ");var h={text:" ",sender:" ",type:"typing"};d.send(JSON.stringify(h))});e.on("submit",function(h){h.preventDefault();var i=a.val();if(i.length>0){$.cookie("chat_name",i);$(".username").text(i)}});d.onopen=function(h){console.log("Connection established");$.ajax({url:"loadMessages.php",dataType:"json",success:function(k){$.each(k,function(){if(this.sender===$.cookie("chat_name")){c.append('<li class="me">'+this.text+"</li>")}else{c.append("<li>"+this.text+"</li>")}})}});var j=$.cookie("chat_name");if(!j){var i=(new Date()).getTime();j="anonymous"+i;$.cookie("chat_name",j)}$(".username").text(j)};d.onmessage=function(h){var i=JSON.parse(h.data);console.log(i.data);if(i.type==="message"){c.append("<li>"+i.data+"</li>")}else{if(i.type==="typing"){if(i.data!==" "){f.html("<span>"+i.data+" typing ...</span>")}else{f.html(" ")}}}};g.on("keyup",function(){var i=g.val().trim();if(i!==""){var h={text:g.val(),sender:$.cookie("chat_name"),type:"typing"};d.send(JSON.stringify(h))}else{var h={text:" ",sender:" ",type:"typing"};d.send(JSON.stringify(h))}})});